<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lesson 4 — Buy, hold, or run?</title>
  <style>
    :root{
      --bg:#0f1115; --card:#171a21; --text:#e7eaf0; --muted:#9aa3b2;
      --brand:#B1FF8C; --line:#242936; --outline:rgba(177,255,140,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:15px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    a{color:inherit; text-decoration:none}

    /* Header (не sticky) */
    .bar{display:flex; align-items:center; justify-content:space-between; padding:12px 16px}
    .back{
      display:inline-block; color:var(--text); font-size:28px; line-height:1;
      padding:2px 6px; border-radius:8px; user-select:none;
    }
    .logo{ height:44px; width:auto; object-fit:contain; display:block }
    @media (max-width:480px){ .logo{ height:36px } }

    .wrap{ max-width:780px; margin:0 auto; padding:10px 16px 40px }

    /* Eyebrow + Title — как в lesson1 */
    .eyebrow{ margin-top:8px; text-align:center; color:var(--muted); font-weight:600 }
    .title{
      margin:6px auto 18px; text-align:center; max-width:680px;
      font-family:Georgia,serif; font-style:italic; font-size:26px; line-height:1.25; font-weight:600;
    }

    /* Card stage */
    .stage{ display:flex; justify-content:center }
    .frame{ width:680px; max-width:100% }

    /* Fade flip (без зеркала) */
    .flip-wrap{ position:relative; height:500px; overflow:hidden }
    .face{ position:absolute; inset:0; display:flex; width:100%; height:100%; transition:opacity .28s ease }
    .front{ opacity:1; pointer-events:auto }
    .back { opacity:0; pointer-events:none }
    .flipped .front{ opacity:0; pointer-events:none }
    .flipped .back { opacity:1; pointer-events:auto }

    .card{
      background:var(--card); border-radius:24px; display:flex; flex-direction:column;
      border:2px solid var(--outline); box-shadow:0 12px 28px rgba(0,0,0,.4);
      padding:16px 16px 64px; width:100%; height:100%; position:relative;
    }
    .card-top{
      border-radius:18px; overflow:hidden; height:200px;
      display:flex; align-items:center; justify-content:center;
    }
    .card-top img{ width:100%; height:100%; object-fit:cover; display:block }

    /* ЕДИНЫЕ стили контента для обеих сторон */
    .face .card-body{ padding:16px 10px 0; text-align:center }
    .face .card-title{ font-size:24px; font-weight:800; line-height:1.22; margin:8px 0 8px }
    .face .card-subttl{ font-size:15px; font-weight:700; color:var(--muted); margin:0 0 6px }
    .face .card-desc{ font-size:14px; line-height:1.5; color:var(--muted); margin:0 }

    /* Flip button */
    .flip-btn{
      position:absolute; left:50%; transform:translateX(-50%); bottom:36px;
      height:42px; padding:0 18px; border-radius:999px; border:0; cursor:pointer;
      display:inline-flex; align-items:center; gap:8px; font-weight:800;
      background:#fff; color:#0a0a0a;
    }
    .flip-btn svg{ width:22px; height:22px; display:block; color:#0a0a0a } /* всегда чёрный */
    .flip-btn:active{ transform:translateX(-50%) scale(.98) }

    /* Gallery nav */
    .gallery-nav{ display:flex; justify-content:center; align-items:center; gap:14px; margin:12px auto 0 }
    .arrow{
      width:44px; height:44px; border-radius:999px; border:1px solid var(--line);
      background:transparent; color:var(--text); cursor:pointer; font-size:20px; line-height:44px
    }
    .arrow:disabled{ opacity:.35; cursor:not-allowed }
    .index{ color:var(--muted); font-size:13px; text-align:center }

    /* CTA как в lesson1 */
    .cta{ display:flex; justify-content:center; margin-top:18px }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:16px 28px; border:0; border-radius:999px;
      background:var(--brand); color:#07110c; font-weight:700;
      box-shadow:0 6px 14px rgba(177,255,140,.25);
    }

    @media (max-width:420px){
      .flip-wrap{ height:460px }
      .card-top{ height:180px }
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <header class="bar">
    <a href="index.html" class="back" aria-label="Back" onclick="pickleBack(); return false;">←</a>
    <img class="logo" src="assets/logo-changelly.png" alt="Changelly">
  </header>

  <main class="wrap">
    <div class="eyebrow">Lesson 4</div>
    <h1 class="title">Buy, hold, or run?<br/>Reading the market without the jargon</h1>

    <div class="stage">
      <div class="frame">
        <div class="flip-wrap" id="deck">
          <!-- FRONT -->
          <section class="face front">
            <article class="card">
              <div class="card-top"><img id="imgFront" alt="Card image"></div>
              <div class="card-body">
                <div id="titleFront" class="card-title">—</div>
                <p class="card-subttl">What’s happening:</p>
                <p id="descFront" class="card-desc">—</p>
              </div>
              <button id="btnFlip1" class="flip-btn" aria-label="Flip card">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <polyline points="23 4 23 10 17 10"></polyline>
                  <polyline points="1 20 1 14 7 14"></polyline>
                  <path d="M3.51 9a9 9 0 0114.13-3.36L23 10"></path>
                  <path d="M20.49 15A9 9 0 016.36 18.36L1 14"></path>
                </svg>
                Flip
              </button>
            </article>
          </section>

          <!-- BACK -->
          <section class="face back">
            <article class="card">
              <div class="card-top"><img id="imgBack" alt="Card image"></div>
              <div class="card-body">
                <div id="titleBack" class="card-title">—</div>
                <p class="card-subttl">Your move:</p>
                <p id="descBack" class="card-desc">—</p>
              </div>
              <button id="btnFlip2" class="flip-btn" aria-label="Flip card back">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <polyline points="23 4 23 10 17 10"></polyline>
                  <polyline points="1 20 1 14 7 14"></polyline>
                  <path d="M3.51 9a9 9 0 0114.13-3.36L23 10"></path>
                  <path d="M20.49 15A9 9 0 016.36 18.36L1 14"></path>
                </svg>
                Flip
              </button>
            </article>
          </section>
        </div>

        <!-- навигация под карточкой -->
        <div class="gallery-nav">
          <button id="prev" class="arrow" aria-label="Previous">‹</button>
          <div id="index" class="index">Card 1/7</div>
          <button id="next" class="arrow" aria-label="Next">›</button>
        </div>
      </div>
    </div>

    <!-- CTA как в lesson1 -->
    <div class="cta">
      <a href="lesson5.html" class="btn" onclick="pickleNext(); return false;">Level up →</a>
    </div>
  </main>

  <!-- прогресс/гейтинг -->
  <script>
  (function(){
    const LESSON_ID = 'l4';
    const order = ['l1','l2','l3','l4','l5'];
    const idToIdx = Object.fromEntries(order.map((id,i)=>[id,i]));
    const tg = window.Telegram?.WebApp;

    const fileFor = id => `lesson${id.replace('l','')}.html`;
    const lastId = localStorage.getItem('pickle_progress') || 'l1';
    const hasEmail = !!localStorage.getItem('pickle_email');

    if (!hasEmail) { location.replace('index.html#join'); return; }
    if (idToIdx[LESSON_ID] > idToIdx[lastId]) {
      try{ tg?.HapticFeedback?.impactOccurred('light'); }catch(_){}
      location.replace(fileFor(lastId)); return;
    }

    window.pickleNext = function(){
      const curIdx = idToIdx[LESSON_ID];
      const savedIdx = idToIdx[localStorage.getItem('pickle_progress') || 'l1'];
      const nextId = order[Math.min(curIdx + 1, order.length - 1)];
      if (curIdx >= savedIdx) {
        localStorage.setItem('pickle_progress', nextId);
        try{ tg?.HapticFeedback?.notificationOccurred('success'); }catch(_){}
      }
      if (curIdx + 1 < order.length) location.href = fileFor(nextId);
      else location.href = 'index.html#breakdown';
    };
    window.pickleBack = function(){ location.href = 'index.html'; };
  })();

  // ===== данные карточек =====
  const cards = [
    {img:'assets/l4-card-1.png', title:'Price is pumping',
     front:"Sudden spike in price, everyone’s tweeting about it",
     back:"Check why it’s pumping. Hype without substance often dumps just as fast"},
    {img:'assets/l4-card-2.png', title:'Big green candle',
     front:"Massive candle, maybe triggered by news or influencer post",
     back:"Already holding? Take partial profits. Not in yet? Add to watchlist. Don’t FOMO"},
    {img:'assets/l4-card-3.png', title:'Dip incoming',
     front:"Price is falling fast. People are panicking on X",
     back:"Zoom out. Is the whole market down or just this coin? If nothing fundamental changed then it could be a buy opportunity"},
    {img:'assets/l4-card-4.png', title:'Market is boring',
     front:"Sideways chop, no major news",
     back:"This is when smart money accumulates. Great time to DCA or research new gems"},
    {img:'assets/l4-card-5.png', title:'Everything is red',
     front:"BTC, ETH, alts: all dropping",
     back:"Usually macro FUD (The Fed, regulations, etc.) Don’t sell in fear. Hold or DCA small if you believe long-term"},
    {img:'assets/l4-card-6.png', title:'Coin got hacked or rugged',
     front:"News of smart contract exploit, rug pull, or delisting",
     back:"Exit fast. Don’t wait. Fundamentals just changed, this is not just a dip"},
    {img:'assets/l4-card-7.png', title:'Whale watching',
     front:"Big wallets are buying/selling",
     back:"Use tools like Arkham or Nansen to spot trends. Don’t blindly follow, find the reasons why"},
  ];

  function bestSrc(path){
    const dpr = Math.min(3, Math.max(1, Math.round(window.devicePixelRatio || 1)));
    if(dpr===1) return path;
    const ext = path.split('.').pop();
    const base = path.slice(0, -(ext.length+1));
    return `${base}@${dpr}x.${ext}`;
  }

  let idx = 0;
  const deck = document.getElementById('deck');
  const frontImg = document.getElementById('imgFront');
  const backImg  = document.getElementById('imgBack');
  const tF = document.getElementById('titleFront');
  const tB = document.getElementById('titleBack');
  const dF = document.getElementById('descFront');
  const dB = document.getElementById('descBack');
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const indexEl = document.getElementById('index');
  const btnFlip1 = document.getElementById('btnFlip1');
  const btnFlip2 = document.getElementById('btnFlip2');

  function render(){
    const c = cards[idx];
    const src = bestSrc(c.img);
    frontImg.src = src; backImg.src = src;
    tF.textContent = c.title; tB.textContent = c.title;
    dF.textContent = c.front; dB.textContent = c.back;

    document.querySelector('.flip-wrap').classList.remove('flipped');
    prev.disabled = idx===0; next.disabled = idx===cards.length-1;
    indexEl.textContent = `Card ${idx+1}/${cards.length}`;
  }
  render();

  prev.addEventListener('click', ()=>{ if(idx>0){ idx--; render(); }});
  next.addEventListener('click', ()=>{ if(idx<cards.length-1){ idx++; render(); }});

  function flip(){ document.querySelector('.flip-wrap').classList.toggle('flipped'); }
  btnFlip1.addEventListener('click', flip);
  btnFlip2.addEventListener('click', flip);
  document.getElementById('deck').addEventListener('click', (e)=>{
    if(e.target.closest('.flip-btn')) return;
    flip();
  }, {passive:true});
  </script>
</body>
</html>
