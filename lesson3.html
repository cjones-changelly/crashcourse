<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lesson 3 — The wallet mistakes that could cost you everything</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --bg:#0f1115; --card:#171a21; --text:#e7eaf0; --muted:#9aa3b2;
    --brand:#B1FF8C; --ink:#0b0e11; --line:#242936; --danger:#ff6b6b;
    --btn-h:52px; --btn-fs:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);
       font:15px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif}
  a{color:inherit;text-decoration:none}

  /* Header */
  .bar{
    position:relative; display:flex; align-items:center; justify-content:space-between;
    padding:12px 16px; background:var(--bg);
  }
  .back{font-size:24px;line-height:1}
  .logo{height:44px;width:auto;object-fit:contain;display:block}
  @media (max-width:480px){.logo{height:36px}}

  /* Slides viewport */
  .viewport{overflow:hidden;position:relative}
  .track{display:flex;transition:transform .28s ease;will-change:transform}
  .slide{flex:0 0 100%;min-height:calc(100dvh - 72px);
         padding:14px 16px 28px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start}
  .wrap{width:100%;max-width:760px;margin:0 auto}

  /* Titles */
  .eyebrow{margin-top:8px;text-align:center;color:var(--muted);font-weight:600}
  .title{margin:6px auto 12px;text-align:center;max-width:720px;
         font-family:Georgia,serif;font-style:italic;font-size:28px;line-height:1.25;font-weight:600}
  .lead{color:var(--muted);text-align:center;max-width:760px;margin:0 auto 10px}
  .lead strong{color:#dfe7f5}

  /* CTA */
  .cta{display:flex;justify-content:center;margin:16px 0 4px}
  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    height:var(--btn-h); padding:0 28px;border:0;border-radius:999px;
    background:var(--brand); color:#07110c;font-size:var(--btn-fs);font-weight:800;line-height:1;
    box-shadow:0 6px 14px rgba(177,255,140,.25); cursor:pointer;
  }
  .btn.secondary{background:#1a2230;color:var(--text);border:1px solid var(--line);box-shadow:none}

  /* Divider */
  .rule{height:1px;background:var(--line);margin:12px auto;max-width:640px;opacity:.85}

  /* Checklist (экран 2) */
  .subTitle{font-family:Georgia,serif;font-style:italic;font-size:22px;text-align:center;margin:8px 0}
  .subNote{margin:6px auto 6px;text-align:center;color:var(--muted);max-width:640px}
  .list{display:grid;gap:10px;margin-top:10px}
  .row{display:grid;grid-template-columns:34px 1fr;gap:10px;align-items:center;
       padding:10px 12px;background:#0d1219;border:1px solid var(--line);border-radius:12px}
  .tick{
    width:26px;height:26px;border-radius:7px;background:#0b121a;border:1px solid #243044;
    display:grid;place-items:center;overflow:hidden;
  }
  .tick-ico{width:18px;height:18px;display:block}

  /* --- Квиз (экран 3) --- */
  .bank, .board{background:#0d1219;border:1px solid var(--line);border-radius:16px}
  .bank{padding:14px;display:flex;flex-wrap:wrap;gap:12px;min-height:92px}
  .board{display:grid;grid-template-columns:1fr 1fr;gap:14px;padding:14px;margin-top:16px}
  @media (max-width:720px){.board{grid-template-columns:1fr}}

  .col{background:#0b1118;border:1px solid var(--line);border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px;min-height:220px}
  .col h3{display:flex;align-items:center;gap:10px;margin:0 0 6px;font-size:20px}
  .label-ico{width:44px;height:44px;display:block}
  .hint{color:var(--muted);font-size:13px;margin:0 0 12px}

  .chip{
    user-select:none;-webkit-user-drag:element; touch-action:none;
    display:inline-flex;align-items:center;justify-content:center;
    padding:10px 14px;border-radius:12px;background:#111824;border:1px solid #243044;
    color:var(--text);font-weight:600;cursor:grab;box-shadow:0 2px 8px rgba(0,0,0,.25);
    transition:transform .1s ease, border-color .15s ease, background .15s ease;
  }
  .chip:active{cursor:grabbing;transform:scale(.98)}
  .chip.dragging{opacity:.85}
  .chip.hidden-src{visibility:hidden}
  .chip.wrong{border-color:var(--danger); box-shadow:0 0 0 2px rgba(255,107,107,.25)}
  .chip.correct{border-color:rgba(177,255,140,.55)}
  .dropping{outline:2px dashed rgba(177,255,140,.45); outline-offset:-6px}

  .ghost{
    position:fixed; left:0; top:0; z-index:9999; pointer-events:none;
    transform:translate(-9999px,-9999px); /* off-screen until positioned */
    border-radius:12px; background:#111824; border:1px solid #243044;
    box-shadow:0 8px 24px rgba(0,0,0,.45); opacity:.95;
  }

  .banner{margin:14px auto 10px;max-width:860px;padding:12px 14px;border-radius:14px;border:1px solid #3a4457;background:#101722;color:#cfd7e3;text-align:center}
  .banner.ok{background:rgba(177,255,140,.12);border-color:rgba(177,255,140,.4);color:#eaffd9}

  /* Нав-точки */
  .nav{position:absolute;left:0;right:0;bottom:8px;display:flex;align-items:center;justify-content:center;gap:10px;pointer-events:none}
  .dots{display:flex;gap:6px}
  .dot{width:6px;height:6px;border-radius:999px;background:#3a4457;opacity:.7}
  .dot.active{background:var(--brand);opacity:1}
</style>
</head>
<body>
  <header class="bar">
    <a href="index.html" class="back" aria-label="Back" onclick="pickleBack();return false;">←</a>
    <img src="assets/logo-changelly.png" alt="Changelly" class="logo">
  </header>

  <div class="viewport" id="vp">
    <div class="track" id="track">

      <!-- SLIDE 1: Intro -->
      <section class="slide">
        <div class="wrap">
          <div class="eyebrow">Lesson 3</div>
          <h1 class="title">The wallet mistakes that could cost you everything</h1>
          <p class="lead">You can pick the right coins and time the market perfectly, but one wallet mistake can wipe it all out. Hackers don’t care how much you’ve invested, because they simply want access. And in crypto, there are no chargebacks or support tickets to save you.</p>
          <p class="lead">This lesson is here to help you build <strong>real wallet hygiene</strong>. These are simple habits that keep your funds safe, even when things get wild.</p>
          <div class="cta"><button class="btn go-next">Next</button></div>
        </div>
      </section>

      <!-- SLIDE 2: Checklist -->
      <section class="slide">
        <div class="wrap">
          <h3 class="subTitle">Your wallet hygiene Checklist</h3>
          <p class="subNote">Think of this like your personal crypto security to-do list. Check off the things you’ve already done, and commit to finishing the rest:</p>
          <div class="rule"></div>

          <div class="list">
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x" alt=""></div><div>I backed up my seed phrase offline (pen + paper, no screenshots!)</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x" alt=""></div><div>I enabled 2FA on all my centralized exchange accounts</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x" alt=""></div><div>I never sign transactions I don’t understand</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x" alt=""></div><div>I use a cold wallet (hardware or offline) for larger sums</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x" alt=""></div><div>I use a separate “degen” wallet for risky mints or airdrops</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x" alt=""></div><div>I triple-check wallet URLs before connecting</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x" alt=""></div><div>I don’t store my seed phrase on my phone, email, or the cloud</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x" alt=""></div><div>I test with small amounts before big transfers</div></div>
          </div>

          <div class="cta"><button class="btn go-next">Time to cook something up ▾</button></div>
        </div>
      </section>

      <!-- SLIDE 3: QUIZ -->
      <section class="slide">
        <div class="wrap">
          <div class="eyebrow">Lesson 3</div>
          <h2 class="title">Safe or risky?</h2>
          <p class="lead">Can you tell the difference between smart security moves and beginner mistakes?
            <span style="color:#9dc8ff;font-weight:700">Drag each item</span> into one of these two boxes:</p>

          <!-- Start pool -->
          <section id="bank" class="bank" aria-label="Items to sort"></section>

          <!-- Drop board -->
          <section class="board" aria-label="Drop zones">
            <div id="safe" class="col" aria-label="Safe practice" data-expect="safe">
              <h3>
                <img class="label-ico" src="assets/icon-safe-practice.png"
                     srcset="assets/icon-safe-practice.png 1x, assets/icon-safe-practice@2x.png 2x" alt="">
                Safe practice
              </h3>
              <p class="hint">Drop the security best-practices here</p>
            </div>
            <div id="risky" class="col" aria-label="Risky behavior" data-expect="risky">
              <h3>
                <img class="label-ico" src="assets/icon-risky-behavior.png"
                     srcset="assets/icon-risky-behavior.png 1x, assets/icon-risky-behavior@2x.png 2x" alt="">
                Risky behavior
              </h3>
              <p class="hint">Drop the beginner mistakes here</p>
            </div>
          </section>

          <div id="banner" class="banner" style="display:none"></div>

          <div class="cta">
            <button id="check" class="btn">Check answers</button>
            <a id="next" class="btn" style="display:none; margin-left:10px">Crushed it! Let’s roll</a>
          </div>
        </div>
      </section>

    </div>

    <div class="nav"><div class="dots" id="dots"></div></div>
  </div>

<script>
  // --------- Слайдер (скролл к верху при смене) ----------
  (function(){
    const track = document.getElementById('track');
    const slides = Array.from(track.children);
    const dotsBox = document.getElementById('dots');
    let i = 0;

    slides.forEach((_, idx)=>{
      const d = document.createElement('span');
      d.className = 'dot' + (idx===0?' active':'');
      dotsBox.appendChild(d);
    });
    const dots = Array.from(dotsBox.children);

    function scrollTop(){
      const el = document.scrollingElement || document.documentElement || document.body;
      el.scrollTop = 0;
    }
    function update(){
      track.style.transform = `translateX(${-i*100}%)`;
      dots.forEach((d,idx)=>d.classList.toggle('active', idx===i));
      try{ window.Telegram?.WebApp?.HapticFeedback?.impactOccurred('light'); }catch(_){}
    }
    function go(n){
      i = Math.max(0, Math.min(slides.length-1, n));
      scrollTop(); update();
    }

    document.querySelectorAll('.go-next').forEach(btn=>{
      btn.addEventListener('click', e=>{
        const slide = e.target.closest('.slide');
        const idx = slides.indexOf(slide);
        go(idx+1);
      });
    });

    // клавиатура и свайп
    window.addEventListener('keydown', e=>{
      if (e.key==='ArrowRight') go(i+1);
      if (e.key==='ArrowLeft') go(i-1);
    });
    let sx=0, dx=0, dragging=false;
    const vp = document.getElementById('vp');
    vp.addEventListener('touchstart', e=>{ sx=e.touches[0].clientX; dragging=true; dx=0; }, {passive:true});
    vp.addEventListener('touchmove', e=>{ if(!dragging) return; dx=e.touches[0].clientX - sx; }, {passive:true});
    vp.addEventListener('touchend', ()=>{ if(!dragging) return; dragging=false;
      const thr=Math.min(80, window.innerWidth*0.12);
      if (dx < -thr) go(i+1); else if (dx > thr) go(i-1);
    });

    update();
  })();
</script>

<script>
/* ------------------ КВИЗ (экран 3): drag & drop ------------------ */
(function(){
  const items = [
    { id:'i1', txt:'Use a hardware wallet', answer:'safe' },
    { id:'i2', txt:'Use a cold wallet for large funds', answer:'safe' },
    { id:'i3', txt:'Store your seed phrase offline', answer:'safe' },
    { id:'i4', txt:'Enable 2FA on exchanges', answer:'safe' },
    { id:'i5', txt:'Click random airdrop links', answer:'risky' },
    { id:'i6', txt:'Sign unknown transactions', answer:'risky' },
    { id:'i7', txt:'Keep all assets in a hot wallet', answer:'risky' },
    { id:'i8', txt:'Share your seed phrase in a Google Doc', answer:'risky' },
  ];

  const bank = document.getElementById('bank');
  const safe = document.getElementById('safe');
  const risky = document.getElementById('risky');
  const banner = document.getElementById('banner');
  const checkBtn = document.getElementById('check');
  const nextBtn = document.getElementById('next');

  // создать чипы
  for (const it of items) {
    const el = document.createElement('div');
    el.className = 'chip';
    el.textContent = it.txt;
    el.id = it.id;
    el.draggable = true; // для десктопа
    el.dataset.answer = it.answer;
    bank.appendChild(el);
  }

  /* ---------- HTML5 DnD для десктопа ---------- */
  let dragId = null;
  document.addEventListener('dragstart', (e)=>{
    const chip = e.target.closest('.chip'); if (!chip) return;
    dragId = chip.id;
    e.dataTransfer.setData('text/plain', chip.id);
    e.dataTransfer.effectAllowed = 'move';
  });
  function allow(e){ e.preventDefault(); e.currentTarget.classList.add('dropping'); }
  function leave(e){ e.currentTarget.classList.remove('dropping'); }
  function dropTo(e){
    e.preventDefault();
    const zone = e.currentTarget; zone.classList.remove('dropping');
    const id = e.dataTransfer.getData('text/plain') || dragId;
    const chip = document.getElementById(id); if (!chip) return;
    zone.appendChild(chip); tidy();
  }
  [bank,safe,risky].forEach(z=>{
    z.addEventListener('dragover', allow);
    z.addEventListener('dragleave', leave);
    z.addEventListener('drop', dropTo);
  });

  /* ---------- Pointer/Touch DnD для мобильных/WebView ---------- */
  let ghost=null, src=null, offX=0, offY=0, curZone=null;

  function zoneFromPoint(x,y){
    const zones=[safe,risky,bank]; // приоритет верхних зон
    for (const z of zones){
      const r=z.getBoundingClientRect();
      if (x>=r.left && x<=r.right && y>=r.top && y<=r.bottom) return z;
    }
    return null;
  }

  function startDrag(chip, x, y){
    if (src) endDrag(); // страховка
    src = chip;
    src.classList.add('dragging','hidden-src');

    const r = src.getBoundingClientRect();
    offX = x - r.left; offY = y - r.top;

    ghost = src.cloneNode(true);
    ghost.classList.add('ghost');
    ghost.style.width = r.width+'px';
    ghost.style.height = r.height+'px';
    document.body.appendChild(ghost);
    moveGhost(x,y);

    document.body.style.userSelect = 'none';
  }

  function moveGhost(x,y){
    if (!ghost) return;
    ghost.style.transform = `translate(${x - offX}px, ${y - offY}px)`;

    // подсветка активной зоны
    const z = zoneFromPoint(x,y);
    if (curZone && curZone!==z) curZone.classList.remove('dropping');
    if (z && curZone!==z){ z.classList.add('dropping'); }
    curZone = z || null;
  }

  function endDrag(x,y){
    if (!src) return;
    if (curZone){ curZone.appendChild(src); }
    src.classList.remove('dragging','hidden-src');

    if (ghost && ghost.parentNode) ghost.parentNode.removeChild(ghost);
    ghost=null; curZone?.classList.remove('dropping'); curZone=null; src=null;
    document.body.style.userSelect = '';

    tidy();
  }

  // Pointer Events (если есть)
  if (window.PointerEvent){
    document.addEventListener('pointerdown', (e)=>{
      const chip = e.target.closest('.chip'); if (!chip) return;
      e.preventDefault();
      chip.setPointerCapture?.(e.pointerId);
      startDrag(chip, e.clientX, e.clientY);
    });
    document.addEventListener('pointermove', (e)=>{
      if (!ghost) return;
      e.preventDefault();
      moveGhost(e.clientX, e.clientY);
    }, {passive:false});
    document.addEventListener('pointerup', (e)=>{
      if (!ghost && !src) return;
      e.preventDefault();
      endDrag(e.clientX, e.clientY);
    });
    document.addEventListener('pointercancel', ()=> endDrag());
  } else {
    // Touch fallback
    document.addEventListener('touchstart', (e)=>{
      const chip = e.target.closest('.chip'); if (!chip) return;
      const t = e.touches[0]; startDrag(chip, t.clientX, t.clientY);
    }, {passive:true});
    document.addEventListener('touchmove', (e)=>{
      if (!ghost) return;
      const t = e.touches[0]; moveGhost(t.clientX, t.clientY);
      e.preventDefault();
    }, {passive:false});
    document.addEventListener('touchend', (e)=>{
      if (!ghost && !src) return;
      const t = e.changedTouches[0] || e.touches[0];
      endDrag(t?.clientX || 0, t?.clientY || 0);
    });
    document.addEventListener('touchcancel', ()=> endDrag());
  }

  /* ---------- Клик-циклинг (оставляем) ---------- */
  const order = [bank, safe, risky];
  document.addEventListener('click', (e)=>{
    const chip = e.target.closest('.chip');
    if (!chip || ghost) return; // во время drag не циклим
    const parent = chip.parentElement; const idx = order.indexOf(parent);
    const next = order[(idx+1)%order.length]; next.appendChild(chip); tidy();
  });

  /* ---------- Служебное ---------- */
  function tidy(){
    banner.style.display='none';
    nextBtn.style.display='none';
    checkBtn.style.display='inline-flex';
    document.querySelectorAll('.chip').forEach(c=>c.classList.remove('wrong','correct'));
  }
  function allPlaced(){ return bank.querySelectorAll('.chip').length===0; }

  // Проверка: подсветка только когда всё разложено
  function check(){
    if (!allPlaced()){
      banner.className='banner';
      banner.textContent='Place every item into one of the boxes first.';
      banner.style.display='block';
      try{ window.Telegram?.WebApp?.HapticFeedback?.impactOccurred('light'); }catch(_){}
      banner.scrollIntoView({behavior:'smooth', block:'start'});
      return;
    }

    document.querySelectorAll('.chip').forEach(c=>c.classList.remove('wrong','correct'));

    let wrong=0;
    [[safe,'safe'], [risky,'risky']].forEach(([col,expected])=>{
      col.querySelectorAll('.chip').forEach(chip=>{
        if (chip.dataset.answer===expected){ chip.classList.add('correct'); }
        else { chip.classList.add('wrong'); wrong++; }
      });
    });

    if (wrong===0){
      banner.className='banner ok';
      banner.textContent='Perfect! You nailed it — every item is in the right place.';
      banner.style.display='block';
      nextBtn.style.display='inline-flex';
      checkBtn.style.display='none';
      try{ window.Telegram?.WebApp?.HapticFeedback?.notificationOccurred('success'); }catch(_){}
    } else {
      banner.className='banner';
      banner.textContent='Not quite — the red ones are in the wrong box. Adjust and check again.';
      banner.style.display='block';
      try{ window.Telegram?.WebApp?.HapticFeedback?.impactOccurred('medium'); }catch(_){}
    }
    banner.scrollIntoView({behavior:'smooth', block:'start'});
  }
  checkBtn.addEventListener('click', check);
  nextBtn.addEventListener('click', ()=>{ if (typeof window.pickleNext==='function') window.pickleNext(); });
})();
</script>

<!-- прогресс/гейтинг для урока 3 -->
<script>
(function(){
  const LESSON_ID = 'l3';
  const order = ['l1','l2','l3','l4','l5'];
  const idToIdx = Object.fromEntries(order.map((id,i)=>[id,i]));
  const tg = window.Telegram?.WebApp;

  const fileFor = id => `lesson${id.replace('l','')}.html`;
  const lastId = localStorage.getItem('pickle_progress') || 'l1';
  const hasEmail = !!localStorage.getItem('pickle_email');

  if (!hasEmail) { location.replace('index.html#join'); return; }
  if (idToIdx[LESSON_ID] > idToIdx[lastId]) {
    try{ tg?.HapticFeedback?.impactOccurred('light'); }catch(_){}
    location.replace(fileFor(lastId));
    return;
  }

  window.pickleNext = function(){
    const curIdx = idToIdx[LESSON_ID];
    const savedIdx = idToIdx[localStorage.getItem('pickle_progress') || 'l1'];
    const nextId = order[Math.min(curIdx + 1, order.length - 1)];

    if (curIdx >= savedIdx) {
      localStorage.setItem('pickle_progress', nextId);
      try{ tg?.HapticFeedback?.notificationOccurred('success'); }catch(_){}
    }

    if (curIdx + 1 < order.length) location.href = fileFor(nextId);
    else location.href = 'index.html#breakdown';
  };

  window.pickleBack = function(){ location.href = 'index.html'; };
})();
</script>
</body>
</html>
