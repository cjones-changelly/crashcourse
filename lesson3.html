<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lesson 3 ‚Äî The wallet mistakes that could cost you everything</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --bg:#0f1115; --card:#171a21; --text:#e7eaf0; --muted:#9aa3b2;
    --brand:#B1FF8C; --ink:#0b0e11; --line:#242936; --danger:#ff6b6b;
    --btn-h:52px; --btn-fs:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font:15px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif;
    overscroll-behavior-y: none; /* –±—ã–ª–æ contain ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±–∏—Ä–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –æ–≤–µ—Ä—Å—Ä–æ–ª–ª */
  }
  a{color:inherit;text-decoration:none}

  /* Header */
  .bar{
    position:relative; display:flex; align-items:center; justify-content:space-between;
    padding:12px 16px; background:var(--bg);
  }
  .back{font-size:24px;line-height:1}
  .logo{height:44px;width:auto;object-fit:contain;display:block}
  @media (max-width:480px){.logo{height:36px}}

  /* Slides viewport */
  .viewport{overflow:hidden;position:relative}
  .track{display:flex;transition:transform .28s ease;will-change:transform}
  .slide{flex:0 0 100%;min-height:calc(100dvh - 72px);
         padding:14px 16px 64px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start}
  .wrap{width:100%;max-width:760px;margin:0 auto}

  /* Titles */
  .eyebrow{margin-top:8px;text-align:center;color:var(--muted);font-weight:600}
  .title{margin:6px auto 12px;text-align:center;max-width:720px;
         font-family:Georgia,serif;font-style:italic;font-size:28px;line-height:1.25;font-weight:600}
  .lead{color:var(--muted);text-align:center;max-width:760px;margin:0 auto 10px}
  .lead strong{color:#dfe7f5}

  /* CTA */
  .cta{display:flex;justify-content:center;margin:16px 0 4px}
  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    height:var(--btn-h); padding:0 28px;border:0;border-radius:999px;
    background:var(--brand); color:#07110c;font-size:var(--btn-fs);font-weight:800;line-height:1;
    box-shadow:0 6px 14px rgba(177,255,140,.25); cursor:pointer;
  }
  .btn.secondary{background:#1a2230;color:var(--text);border:1px solid var(--line);box-shadow:none}

  /* Divider */
  .rule{height:1px;background:var(--line);margin:12px auto;max-width:640px;opacity:.85}

  /* Checklist (—ç–∫—Ä–∞–Ω 2) */
  .subTitle{font-family:Georgia,serif;font-style:italic;font-size:22px;text-align:center;margin:8px 0}
  .subNote{margin:6px auto 6px;text-align:center;color:var(--muted);max-width:640px}
  .list{display:grid;gap:10px;margin-top:10px}
  .row{
    display:grid;grid-template-columns:44px 1fr; /* –±—ã–ª–æ 34px ‚Äî –±–æ–ª—å—à–µ –ø–æ–¥ —É–≤–µ–ª–∏—á–µ–Ω–Ω—É—é –∏–∫–æ–Ω–∫—É */
    gap:10px;align-items:center;
    padding:10px 12px;background:#0d1219;border:1px solid var(--line);border-radius:12px
  }
  .tick{
    width:34px;height:34px;border-radius:7px;
    background:transparent; /* —É–±—Ä–∞–Ω–∞ –ø–æ–¥–ª–æ–∂–∫–∞ */
    border:none;            /* —É–±—Ä–∞–Ω–∞ –æ–±–≤–æ–¥–∫–∞ */
    display:grid;place-items:center;overflow:hidden;
  }
  .tick-ico{width:28px;height:28px;display:block} /* –±—ã–ª–æ 18x18 ‚Äî —Å—Ç–∞–ª–∞ –∫—Ä—É–ø–Ω–µ–µ */

  /* --- –ö–≤–∏–∑ (—ç–∫—Ä–∞–Ω 3) --- */
  .bank, .board{background:#0d1219; border:none; border-radius:16px}
  .bank{background:var(--bg); /* ‚úÖ –ø–æ–¥–ª–æ–∂–∫–∞ –∫–∞–∫ —É —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        padding:14px;display:flex;flex-wrap:wrap;gap:12px;min-height:92px}
  .board{display:grid;grid-template-columns:1fr 1fr;gap:14px;padding:14px;margin-top:16px}
  @media (max-width:720px){.board{grid-template-columns:1fr}}

  .col{background:#0b1118;border:1px solid var(--line);border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px;min-height:220px}
  .col h3{display:flex;align-items:center;gap:10px;margin:0 0 6px;font-size:20px}
  .label-ico{width:44px;height:44px;display:block}
  .hint{color:var(--muted);font-size:13px;margin:0 0 12px}

  .chip{
    user-select:none; -webkit-user-drag:element; touch-action:none;
    display:inline-flex;align-items:center;justify-content:center;
    padding:10px 14px;border-radius:12px;background:#111824;border:1px solid #243044;
    color:var(--text);font-weight:600;cursor:grab;box-shadow:0 2px 8px rgba(0,0,0,.25);
    transition:transform .06s ease, border-color .15s ease, background .15s ease, opacity .06s ease;
  }
  .chip:active{cursor:grabbing}
  .chip.dragging{opacity:1; transform:scale(1.04)}
  .ph{display:inline-block; border-radius:12px; background:transparent}

  /* ‚ú® –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —á–∏–ø–∞ */
  .chip.pressed{
    border-color: rgba(177,255,140,.85);
    background: rgba(177,255,140,.14);
    box-shadow: 0 0 0 2px rgba(177,255,140,.28), 0 6px 14px rgba(0,0,0,.35);
    transform: scale(1.03);
  }

  .ghost{
    position:fixed; left:0; top:0; z-index:10000; pointer-events:none;
    border:2px solid var(--brand);
    background:#152131; color:var(--text);
    border-radius:12px;
    box-shadow:0 14px 34px rgba(0,0,0,.55), 0 0 0 3px rgba(177,255,140,.22);
    transform:translate3d(0,0,0) scale(1.06);
  }

  .dropping{outline:2px dashed rgba(177,255,140,.45); outline-offset:-6px}

  .banner{margin:14px auto 10px;max-width:860px;padding:12px 14px;border-radius:14px;border:1px solid #3a4457;background:#101722;color:#cfd7e3;text-align:center}
  .banner.ok{background:rgba(177,255,140,.12);border-color:rgba(177,255,140,.4);color:#eaffd9}

  /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
  .chip.correct{
    border-color:rgba(177,255,140,.85);
    background:rgba(177,255,140,.14);
    box-shadow:0 0 0 2px rgba(177,255,140,.3);
  }
  .chip.wrong{
    border-color:var(--danger);
    background:rgba(255,107,107,.12);
    box-shadow:0 0 0 2px rgba(255,107,107,.28);
  }

  /* –ù–∞–≤-—Ç–æ—á–∫–∏ */
  .nav{position:absolute;left:0;right:0;bottom:40px;display:flex;align-items:center;justify-content:center;gap:10px;pointer-events:none}
  .dots{display:flex;gap:6px}
  .dot{width:6px;height:6px;border-radius:999px;background:#3a4457;opacity:.7}
  .dot.active{background:var(--brand);opacity:1}

  /* –°—Ç—Ä–µ–ª–∫–∏ –≤ —É–≥–ª–∞—Ö */
  .nav-arrows{position:fixed;left:0;right:0;bottom:8px;z-index:5;pointer-events:none}
  .nav-btn{
    pointer-events:auto;
    position:absolute; bottom:8px;
    width:38px; height:38px; border-radius:999px;
    border:1px solid #2a3547; background:#0f1622a8; color:#dfe7f5;
    display:grid; place-items:center; font-size:18px; font-weight:700;
    box-shadow:0 6px 14px rgba(0,0,0,.25);
    backdrop-filter: blur(6px);
  }
  .nav-btn:hover{transform:translateY(-1px)}
  .nav-btn:active{transform:translateY(0)}
  .nav-left{left:10px}
  .nav-right{right:10px}

  /* ‚ûï FIX: –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Äî –º–µ–Ω—å—à–µ ¬´–¥–Ω–∞¬ª –∏ –∫–Ω–æ–ø–∫–∞ Next –Ω–µ —É—Ö–æ–¥–∏—Ç –≤—ã—à–µ —Ü–µ–Ω—Ç—Ä–∞ */
  .track .slide:first-child{ padding-bottom:16px; }
  .track .slide:first-child .cta{
    position:sticky;
    top:calc(50dvh - var(--btn-h)/2);
    z-index:1;
  }
</style>
</head>
<body>
  <header class="bar">
    <a href="index.html" class="back" aria-label="Back" onclick="pickleBack();return false;">‚Üê</a>
    <img
      class="logo"
      src="assets/logo-changelly.png"
      srcset="assets/logo-changelly.png 1x, assets/logo-changelly@2x.png 2x, assets/logo-changelly@3x.png 3x"
      alt="Changelly">
  </header>

  <div class="viewport" id="vp">
    <div class="track" id="track">

      <!-- SLIDE 1: Intro -->
      <section class="slide">
        <div class="wrap">
          <div class="eyebrow">Lesson 3</div>
          <h1 class="title">The wallet mistakes that could cost you everything</h1>
          <p class="lead">You can pick the right coins and time the market perfectly, but one wallet mistake can wipe it all out. Hackers don‚Äôt care how much you‚Äôve invested, because they simply want access. And in crypto, there are no chargebacks or support tickets to save you.</p>
          <p class="lead">This lesson is here to help you build <strong>real wallet hygiene</strong>. These are simple habits that keep your funds safe, even when things get wild.</p>
          <div class="cta"><button class="btn go-next">Next</button></div>
        </div>
      </section>

      <!-- SLIDE 2: Checklist -->
      <section class="slide">
        <div class="wrap">
          <h3 class="subTitle">Your wallet hygiene Checklist</h3>
          <p class="subNote">Think of this like your personal crypto security to-do list. Check off the things you‚Äôve already done, and commit to finishing the rest:</p>
          <div class="rule"></div>

          <div class="list">
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x, assets/icon-check@3x.png 3x" alt=""></div><div>I backed up my seed phrase offline (pen + paper, no screenshots!)</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x, assets/icon-check@3x.png 3x" alt=""></div><div>I enabled 2FA on all my centralized exchange accounts</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x, assets/icon-check@3x.png 3x" alt=""></div><div>I never sign transactions I don‚Äôt understand</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x, assets/icon-check@3x.png 3x" alt=""></div><div>I use a cold wallet (hardware or offline) for larger sums</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x, assets/icon-check@3x.png 3x" alt=""></div><div>I use a separate ‚Äúdegen‚Äù wallet for risky mints or airdrops</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x, assets/icon-check@3x.png 3x" alt=""></div><div>I triple-check wallet URLs before connecting</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x, assets/icon-check@3x.png 3x" alt=""></div><div>I don‚Äôt store my seed phrase on my phone, email, or the cloud</div></div>
            <div class="row"><div class="tick"><img class="tick-ico" src="assets/icon-check.png" srcset="assets/icon-check.png 1x, assets/icon-check@2x.png 2x, assets/icon-check@3x.png 3x" alt=""></div><div>I test with small amounts before big transfers</div></div>
          </div>

          <div class="cta"><button class="btn go-next">Time to cook something up</button></div>
        </div>
      </section>

      <!-- SLIDE 3: QUIZ -->
      <section class="slide">
        <div class="wrap">
          <h3 class="subTitle">Safe or risky?</h3>
          <p class="lead">Can you tell the difference between smart security moves and beginner mistakes?
            <strong>Drag each item</strong> into one of these two boxes:</p>

          <!-- Start pool -->
          <section id="bank" class="bank" aria-label="Items to sort"></section>

          <!-- Drop board -->
          <section class="board" aria-label="Drop zones">
            <div id="safe" class="col" aria-label="Safe practice" data-expect="safe">
              <h3>
                <img class="label-ico" src="assets/icon-safe-practice.png"
                     srcset="assets/icon-safe-practice.png 1x, assets/icon-safe-practice@2x.png 2x" alt="">
                Safe practice
              </h3>
              <p class="hint">Drop the security best-practices here</p>
            </div>
            <div id="risky" class="col" aria-label="Risky behavior" data-expect="risky">
              <h3>
                <img class="label-ico" src="assets/icon-risky-behavior.png"
                     srcset="assets/icon-risky-behavior.png 1x, assets/icon-risky-behavior@2x.png 2x" alt="">
                Risky behavior
              </h3>
              <p class="hint">Drop the beginner mistakes here</p>
            </div>
          </section>

          <div id="banner" class="banner" style="display:none"></div>

          <div class="cta">
            <button id="check" class="btn">Check answers</button>
            <a id="next" class="btn" style="display:none; margin-left:10px">Crushed it! Let‚Äôs roll</a>
          </div>
        </div>
      </section>

    </div>

    <div class="nav"><div class="dots" id="dots"></div></div>
    <div class="nav-arrows">
      <button class="nav-btn nav-left" id="navLeft" aria-label="Previous">‚Äπ</button>
      <button class="nav-btn nav-right" id="navRight" aria-label="Next">‚Ä∫</button>
    </div>
  </div>

<script>
  // --------- –°–ª–∞–π–¥–µ—Ä ----------
  (function(){
    const track = document.getElementById('track');
    const slides = Array.from(track.children);
    const dotsBox = document.getElementById('dots');
    const btnL = document.getElementById('navLeft');
    const btnR = document.getElementById('navRight');
    let i = 0;

    slides.forEach((_, idx)=>{
      const d = document.createElement('span');
      d.className = 'dot' + (idx===0?' active':'');
      dotsBox.appendChild(d);
    });
    const dots = Array.from(dotsBox.children);

    function scrollTop(){
      const el = document.scrollingElement || document.documentElement || document.body;
      el.scrollTop = 0;
    }
    function update(){
      track.style.transform = `translateX(${-i*100}%)`;
      dots.forEach((d,idx)=>d.classList.toggle('active', idx===i));
      btnL.style.display = (i>0) ? 'grid' : 'none';
      btnR.style.display = (i<slides.length-1) ? 'grid' : 'none';
      try{ window.Telegram?.WebApp?.HapticFeedback?.impactOccurred('light'); }catch(_){}
    }
    function go(n){
      i = Math.max(0, Math.min(slides.length-1, n));
      scrollTop(); update();
    }

    document.querySelectorAll('.go-next').forEach(btn=>{
      btn.addEventListener('click', e=>{
        const slide = e.target.closest('.slide');
        const idx = slides.indexOf(slide);
        go(idx+1);
      });
    });

    btnL.addEventListener('click', ()=> go(i-1));
    btnR.addEventListener('click', ()=> go(i+1));

    window.addEventListener('keydown', e=>{
      if (e.key==='ArrowRight') go(i+1);
      if (e.key==='ArrowLeft') go(i-1);
    });

    update();
  })();
</script>

<script>
/* ------------------ –ö–í–ò–ó (—ç–∫—Ä–∞–Ω 3): drag & drop + –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª ------------------ */
(function(){
  const items = [
    { id:'i1', txt:'Use a hardware wallet', answer:'safe' },
    { id:'i2', txt:'Use a cold wallet for large funds', answer:'safe' },
    { id:'i3', txt:'Store your seed phrase offline', answer:'safe' },
    { id:'i4', txt:'Enable 2FA on exchanges', answer:'safe' },
    { id:'i5', txt:'Click random airdrop links', answer:'risky' },
    { id:'i6', txt:'Sign unknown transactions', answer:'risky' },
    { id:'i7', txt:'Keep all assets in a hot wallet', answer:'risky' },
    { id:'i8', txt:'Share your seed phrase in a Google Doc', answer:'risky' },
  ];

  const bank = document.getElementById('bank');
  const safe = document.getElementById('safe');
  const risky = document.getElementById('risky');
  const banner = document.getElementById('banner');
  const checkBtn = document.getElementById('check');
  const nextBtn = document.getElementById('next');
  const tg = window.Telegram?.WebApp;

  // —Å–æ–∑–¥–∞—Ç—å —á–∏–ø—ã (—Ä–∞–Ω–¥–æ–º–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º –±–∞–Ω–∫–µ)
  (function(){
    const arr = items.slice(); // –∫–æ–ø–∏—è
    for (let i = arr.length - 1; i > 0; i--) {
      const rand = (window.crypto && window.crypto.getRandomValues)
        ? window.crypto.getRandomValues(new Uint32Array(1))[0] / 0x100000000
        : Math.random();
      const j = Math.floor(rand * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    for (const it of arr) {
      const el = document.createElement('div');
      el.className = 'chip';
      el.textContent = it.txt;
      el.id = it.id;
      el.dataset.answer = it.answer;
      el.draggable = false;
      bank.appendChild(el);
    }
  })();

  // -------- Pointer/Touch DnD —Å –ø—Ä–∏–∑—Ä–∞–∫–æ–º, –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–º –∏ –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª–æ–º --------
  let isDragging=false, chip=null, ph=null, ghost=null, curZone=null;
  let downX=0, downY=0, dragArmed=false, pointerId=null;
  let offX=0, offY=0, curX=0, curY=0;
  const THRESH = 6;

  function zoneFromPoint(x,y){
    const zones=[safe,risky,bank];
    for (const z of zones){
      const r=z.getBoundingClientRect();
      if (x>=r.left && x<=r.right && y>=r.top && y<=r.bottom) return z;
    }
    return null;
  }

  function beginDrag(x,y){
    if (!chip) return;
    isDragging = true;

    const r = chip.getBoundingClientRect();
    ph = document.createElement('div');
    ph.className = 'ph';
    ph.style.width = r.width+'px';
    ph.style.height = r.height+'px';
    chip.parentElement.insertBefore(ph, chip);

    chip.style.opacity = '.2'; // –æ—Å—Ç–∞–≤–ª—è–µ–º pressed-–∫–ª–∞—Å—Å –¥–ª—è –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç–∏

    ghost = chip.cloneNode(true);
    ghost.removeAttribute('id');
    ghost.classList.add('ghost');
    ghost.style.width = r.width+'px';
    ghost.style.height = r.height+'px';
    ghost.style.left = r.left+'px';
    ghost.style.top  = r.top+'px';
    document.body.appendChild(ghost);

    offX = x - r.left; offY = y - r.top;

    document.body.style.userSelect = 'none';
    document.body.style.touchAction = 'none';
    try{ tg?.disableVerticalSwipes?.(); }catch(_){}

    startAutoScroll();
  }

  function moveDrag(x,y){
    if (!isDragging || !ghost) return;
    curX = x; curY = y;
    ghost.style.left = (x-offX)+'px';
    ghost.style.top  = (y-offY)+'px';

    const z = zoneFromPoint(x,y);
    if (curZone && curZone!==z) curZone.classList.remove('dropping');
    if (z && curZone!==z) z.classList.add('dropping');
    curZone = z || null;
  }

  function clearPressed(){
    document.querySelectorAll('.chip.pressed').forEach(el=>el.classList.remove('pressed'));
  }

  function finishDrag(){
    if (!chip) return;

    stopAutoScroll();

    if (curZone){ curZone.appendChild(chip); }
    else if (ph && ph.parentNode){ ph.parentNode.insertBefore(chip, ph); }

    chip.style.opacity = '';
    clearPressed();               /* —Å–Ω—è—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É */
    curZone?.classList.remove('dropping');
    curZone=null;

    if (ghost && ghost.parentNode) ghost.parentNode.removeChild(ghost);
    ghost=null;

    if (ph && ph.parentNode) ph.parentNode.removeChild(ph);
    ph=null; chip=null; isDragging=false;

    document.body.style.userSelect = '';
    document.body.style.touchAction = '';
    try{ tg?.enableVerticalSwipes?.(); }catch(_){}

    tidy();
  }

  // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–æ –≤—Ä–µ–º—è –¥—Ä–∞–≥–∞
  let rafId=null;
  function autoScrollStep(){
    if (!isDragging) return;
    const margin = 80;
    const maxSpeed = 22;
    let dy = 0;

    if (curY < margin){
      dy = -Math.ceil(((margin - curY) / margin) * maxSpeed);
    } else if (curY > window.innerHeight - margin){
      dy = Math.ceil(((curY - (window.innerHeight - margin)) / margin) * maxSpeed);
    }

    if (dy !== 0){
      window.scrollBy(0, dy);
    }
    rafId = requestAnimationFrame(autoScrollStep);
  }
  function startAutoScroll(){
    stopAutoScroll();
    rafId = requestAnimationFrame(autoScrollStep);
  }
  function stopAutoScroll(){
    if (rafId){ cancelAnimationFrame(rafId); rafId=null; }
  }

  if (window.PointerEvent){
    document.addEventListener('pointerdown', (e)=>{
      const c = e.target.closest('.chip'); if (!c) return;
      pointerId = e.pointerId;
      c.setPointerCapture?.(pointerId);
      c.classList.add('pressed');         /* ‚ú® –ø–æ–¥—Å–≤–µ—Ç–∫–∞ */
      chip = c; dragArmed=true; downX=e.clientX; downY=e.clientY;
      e.preventDefault();
    });
    document.addEventListener('pointermove', (e)=>{
      if (!chip) return;
      const dx = e.clientX - downX, dy = e.clientY - downY;
      if (dragArmed && (dx*dx + dy*dy) > THRESH*THRESH){
        dragArmed=false; beginDrag(e.clientX, e.clientY);
      }
      if (isDragging){ e.preventDefault(); moveDrag(e.clientX, e.clientY); }
    }, {passive:false});
    document.addEventListener('pointerup', (e)=>{
      if (!chip) return;
      if (isDragging){ e.preventDefault(); finishDrag(); return; }
      const order=[bank,safe,risky];
      const parent = chip.parentElement; const idx = order.indexOf(parent);
      const next = order[(idx+1)%order.length]; next.appendChild(chip);
      clearPressed();                       /* —Å–Ω—è—Ç—å –ø–æ—Å–ª–µ ¬´—Ç–∞–ø-–ø–µ—Ä–µ–Ω–æ—Å–∞¬ª */
      chip=null; dragArmed=false; tidy();
    });
    document.addEventListener('pointercancel', ()=>{ if (chip) finishDrag(); });
  } else {
    // Touch fallback
    document.addEventListener('touchstart', (e)=>{
      const c = e.target.closest('.chip'); if (!c) return;
      const t = e.touches[0]; c.classList.add('pressed'); /* ‚ú® */
      chip=c; dragArmed=true; downX=t.clientX; downY=t.clientY;
    }, {passive:true});
    document.addEventListener('touchmove', (e)=>{
      if (!chip) return;
      const t = e.touches[0]; const dx=t.clientX-downX, dy=t.clientY-downY;
      if (dragArmed && (dx*dx + dy*dy) > THRESH*THRESH){ dragArmed=false; beginDrag(t.clientX, t.clientY); }
      if (isDragging){ moveDrag(t.clientX, t.clientY); e.preventDefault(); }
    }, {passive:false});
    document.addEventListener('touchend', (e)=>{
      if (!chip) return;
      if (isDragging){ finishDrag(); return; }
      const order=[bank,safe,risky];
      const parent = chip.parentElement; const idx = order.indexOf(parent);
      const next = order[(idx+1)%order.length]; next.appendChild(chip);
      clearPressed();
      chip=null; dragArmed=false; tidy();
    }, {passive:true});
    document.addEventListener('touchcancel', ()=>{ if (chip) finishDrag(); });
  }

  /* ---------- –°–ª—É–∂–µ–±–Ω–æ–µ ---------- */
  function tidy(){
    banner.style.display='none';
    nextBtn.style.display='none';
    checkBtn.style.display='inline-flex';
    document.querySelectorAll('.chip').forEach(c=>c.classList.remove('wrong','correct'));
  }
  function allPlaced(){ return bank.querySelectorAll('.chip').length===0; }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞
  function check(){
    if (!allPlaced()){
      banner.className='banner';
      banner.textContent='Place every item into one of the boxes first.';
      banner.style.display='block';
      try{ window.Telegram?.WebApp?.HapticFeedback?.impactOccurred('light'); }catch(_){}
      banner.scrollIntoView({behavior:'smooth', block:'start'});
      return;
    }

    document.querySelectorAll('.chip').forEach(c=>c.classList.remove('wrong','correct'));

    let wrong=0;
    [[safe,'safe'], [risky,'risky']].forEach(([col,expected])=>{
      col.querySelectorAll('.chip').forEach(ch=>{
        if (ch.dataset.answer===expected){ ch.classList.add('correct'); }
        else { ch.classList.add('wrong'); wrong++; }
      });
    });

    if (wrong===0){
      banner.className='banner ok';
      banner.textContent='Perfect! You nailed it ‚Äî every item is in the right place.';
      banner.style.display='block';
      nextBtn.style.display='inline-flex';
      checkBtn.style.display='none';
      try{ window.Telegram?.WebApp?.HapticFeedback?.notificationOccurred('success'); }catch(_){}
    } else {
      banner.className='banner';
      banner.textContent='Not quite ‚Äî the red ones are in the wrong box. Adjust and check again.';
      banner.style.display='block';
      try{ window.Telegram?.WebApp?.HapticFeedback?.impactOccurred('medium'); }catch(_){}
    }
    banner.scrollIntoView({behavior:'smooth', block:'start'});
  }
  checkBtn.addEventListener('click', check);
  nextBtn.addEventListener('click', ()=>{ if (typeof window.pickleNext==='function') window.pickleNext(); });
})();
</script>

<!-- –ø—Ä–æ–≥—Ä–µ—Å—Å/–≥–µ–π—Ç–∏–Ω–≥ –¥–ª—è —É—Ä–æ–∫–∞ 3 -->
<script>
(function(){
  const LESSON_ID = 'l3';
  const order = ['l1','l2','l3','l4','l5'];
  const idToIdx = Object.fromEntries(order.map((id,i)=>[id,i]));
  const tg = window.Telegram?.WebApp;

  const fileFor = id => `lesson${id.replace('l','')}.html`;
  const lastId = localStorage.getItem('pickle_progress') || 'l1';
  const hasEmail = !!localStorage.getItem('pickle_email');

  if (!hasEmail) { location.replace('index.html#join'); return; }
  if (idToIdx[LESSON_ID] > idToIdx[lastId]) {
    try{ tg?.HapticFeedback?.impactOccurred('light'); }catch(_){}
    location.replace(fileFor(lastId));
    return;
  }

  window.pickleNext = function(){
    const curIdx = idToIdx[LESSON_ID];
    const savedIdx = idToIdx[localStorage.getItem('pickle_progress') || 'l1'];
    const nextId = order[Math.min(curIdx + 1, order.length - 1)];

    if (curIdx >= savedIdx) {
      localStorage.setItem('pickle_progress', nextId);
      try{ tg?.HapticFeedback?.notificationOccurred('success'); }catch(_){}
    }

    if (curIdx + 1 < order.length) location.href = fileFor(nextId);
    else location.href = 'index.html#breakdown';
  };

  window.pickleBack = function(){ location.href = 'index.html'; };
})();
</script>

<!-- üõ°Ô∏è Guard –æ—Ç ¬´—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è¬ª –º–∏–Ω–∏–∞–ø–ø–∞ —Å–≤–∞–π–ø–æ–º –≤–Ω–∏–∑ –æ—Ç –≤–µ—Ä—Ö–Ω–µ–π –∫—Ä–æ–º–∫–∏ -->
<script>
(function(){
  const root = document.getElementById('vp'); // –∑–∞—â–∏—â–∞–µ–º –≤–µ—Å—å –≤—å—é–ø–æ—Ä—Ç —É—Ä–æ–∫–∞
  let guard = false, startY = 0;

  function onStart(e){
    const t = e.touches ? e.touches[0] : e;
    const atTop = (window.scrollY || document.documentElement.scrollTop || document.body.scrollTop || 0) <= 0;
    // –°—Ç–∞—Ä—Ç –∂–µ—Å—Ç–∞ —É –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫—Ä–∞—è (–ø–µ—Ä–≤—ã–µ ~24px) –ø—Ä–∏ –≤–µ—Ä—Ö–Ω–µ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–µ ‚Äî –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º
    if (atTop && t.clientY <= 24){
      guard = true; startY = t.clientY;
      e.preventDefault();
    } else {
      guard = false;
    }
  }
  function onMove(e){
    if (!guard) return;
    const t = e.touches ? e.touches[0] : e;
    // –ë–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑ (pull-down)
    if (t.clientY - startY > 0){
      e.preventDefault();
    } else {
      guard = false;
    }
  }
  function onEnd(){ guard = false; }

  root.addEventListener('touchstart', onStart, {passive:false});
  root.addEventListener('touchmove', onMove,   {passive:false});
  root.addEventListener('touchend', onEnd,     {passive:true});
  root.addEventListener('touchcancel', onEnd,  {passive:true});
})();
</script>
</body>
</html>
